# üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è —Å Telegram CloudStorage –Ω–∞ Redis

## –ü—Ä–æ–±–ª–µ–º–∞

**–î–æ –º–∏–≥—Ä–∞—Ü–∏–∏:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è `Telegram.WebApp.CloudStorage` –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- –≠—Ç–æ —Å–æ–∑–¥–∞–≤–∞–ª–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å Telegram
- –ü–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Ç–µ—Ä—è–ª–æ—Å—å, –∫–µ—à –±—ã–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- –ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ Telegram API –ø—Ä–∏ –∫–∞–∂–¥–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ –∫–µ—à—É

**–ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏:**
- ‚úÖ –í–µ—Å—å –∫–µ—à —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ Redis –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (Render)
- ‚úÖ –ù–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è Telegram
- ‚úÖ –ö–µ—à —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- ‚úÖ –ù–µ—Ç –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ Telegram API
- ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ –∏ –Ω–∞–¥–µ–∂–Ω–µ–µ

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### Backend

1. **–ù–æ–≤—ã–π —Ä–æ—É—Ç–µ—Ä** `backend/routers/cache.py`
   - `GET /cache/{key}` - –ø–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –∫–µ—à–∞
   - `PUT /cache/{key}` - —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –∫–µ—à
   - `DELETE /cache/{key}` - —É–¥–∞–ª–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ –∫–µ—à–∞
   - `DELETE /cache/` - –æ—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å –∫–µ—à –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ app.py**
   - –†–æ—É—Ç–µ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### Frontend

1. **–û–±–Ω–æ–≤–ª–µ–Ω `frontend/src/api.js`**
   - –î–æ–±–∞–≤–ª–µ–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏: `getCacheItem`, `setCacheItem`, `deleteCacheItem`, `clearAllCache`

2. **–û–±–Ω–æ–≤–ª–µ–Ω `frontend/src/storage.js`**
   - –£–±—Ä–∞–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç `Telegram.WebApp.CloudStorage`
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Redis –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
   - –°–æ—Ö—Ä–∞–Ω–µ–Ω fallback –Ω–∞ localStorage –¥–ª—è –≤–µ–±-–±—Ä–∞—É–∑–µ—Ä–∞

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### 1. –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç Telegram
- –ö–µ—à —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –∫–æ–≥–¥–∞ Telegram WebApp –∑–∞–∫—Ä—ã—Ç
- –ù–µ—Ç –ø—Ä–æ–±–ª–µ–º —Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –î–∞–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã —Å—Ä–∞–∑—É –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### 2. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- Redis –±—ã—Å—Ç—Ä–µ–µ —á–µ–º Telegram CloudStorage
- –ú–µ–Ω—å—à–µ –∑–∞–¥–µ—Ä–∂–µ–∫ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –∫–µ—à–µ–º
- –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –±–ª–∏–∂–µ –∫ —Å–µ—Ä–≤–µ—Ä—É

### 3. –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å
- Redis –Ω–∞ Render - —Å—Ç–∞–±–∏–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã
- –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π Telegram API

### 4. –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å
- Redis –º–æ–∂–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å –±–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏

## TTL (–≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫–µ—à–∞)

| –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö | TTL | –ü—Ä–∏—á–∏–Ω–∞ |
|------------|-----|---------|
| `feed` | 30 —Å–µ–∫ | –ß–∞—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è |
| `market` | 5 –º–∏–Ω | –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ |
| `leaderboard` | 1 –º–∏–Ω | –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ä–µ–∂–µ |
| `banners` | 5 –º–∏–Ω | –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ |
| `history` | 5 –º–∏–Ω | –†–µ–¥–∫–æ –∏–∑–º–µ–Ω—è–µ—Ç—Å—è |
| –î—Ä—É–≥–∏–µ | 1 –º–∏–Ω | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:
```javascript
// Frontend
await setCachedData('feed', feedData);

// –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
// 1. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ memoryCache (–º–≥–Ω–æ–≤–µ–Ω–Ω–æ)
// 2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å PUT /cache/feed –Ω–∞ —Å–µ—Ä–≤–µ—Ä
// 3. –°–µ—Ä–≤–µ—Ä —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ Redis —Å TTL=30 —Å–µ–∫
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:
```javascript
// Frontend
const feed = await getCachedData('feed');

// –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:
// 1. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è memoryCache (–º–≥–Ω–æ–≤–µ–Ω–Ω–æ, –µ—Å–ª–∏ –µ—Å—Ç—å)
// 2. –ï—Å–ª–∏ –Ω–µ—Ç - –∑–∞–ø—Ä–æ—Å GET /cache/feed
// 3. –°–µ—Ä–≤–µ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç Redis
// 4. –ï—Å–ª–∏ –µ—Å—Ç—å - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–∑ Redis
// 5. –ï—Å–ª–∏ –Ω–µ—Ç - –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 404, –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ API
```

## –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

–ï—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —É–∂–µ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ Telegram CloudStorage:

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è** (–ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏):
   - –ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –¥–∞–Ω–Ω—ã—Ö —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è Redis
   - –ï—Å–ª–∏ –Ω–µ—Ç - –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ API –∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Redis
   - –°—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ CloudStorage –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è

2. **–†—É—á–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
   - –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ CloudStorage –≤ Redis
   - –ù–æ –æ–±—ã—á–Ω–æ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è - –¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –≤ Telegram WebApp (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç Redis API)
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –≤ –≤–µ–±-–±—Ä–∞—É–∑–µ—Ä–µ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç localStorage)
- ‚úÖ Fallback –Ω–∞ localStorage –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö API
- ‚úÖ –°—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ CloudStorage –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è (–Ω–µ –º–µ—à–∞—é—Ç)

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã Redis –∫–µ—à–∞:

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Redis –Ω–∞ Render
redis-cli -h <redis-host> -p <redis-port>

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–ª—é—á–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
KEYS user_cache:*

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á
GET "user_cache:123456789:feed"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å TTL
TTL "user_cache:123456789:feed"
```

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:

1. **Cache Hit Rate** - –ø—Ä–æ—Ü–µ–Ω—Ç –ø–æ–ø–∞–¥–∞–Ω–∏–π –≤ –∫–µ—à
   - –¶–µ–ª—å: > 80%
   - –§–æ—Ä–º—É–ª–∞: `hits / (hits + misses) * 100`

2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏ Redis**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: `redis-cli INFO memory`
   - –¶–µ–ª—å: < 80% –æ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–π –ø–∞–º—è—Ç–∏

3. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: `redis-cli DBSIZE`
   - –ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å = ~5-10 –∫–ª—é—á–µ–π

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–µ—à –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω—ã:**
1. Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
2. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π Telegram ID –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö
3. –û—à–∏–±–∫–∞ —Å–µ—Ç–∏

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Redis –∑–∞–ø—É—â–µ–Ω
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-Telegram-Id` –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö

### –ü—Ä–æ–±–ª–µ–º–∞: –î–∞–Ω–Ω—ã–µ —É—Å—Ç–∞—Ä–µ–ª–∏

**–ü—Ä–∏—á–∏–Ω—ã:**
1. TTL —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π
2. –ö–µ—à –Ω–µ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏

**–†–µ—à–µ–Ω–∏–µ:**
- –£–º–µ–Ω—å—à–∏—Ç–µ TTL –¥–ª—è —á–∞—Å—Ç–æ –∏–∑–º–µ–Ω—è–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `clearCache()` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–æ–±–ª–µ–º–∞: –í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏

**–ü—Ä–∏—á–∏–Ω—ã:**
1. –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
2. –ë–æ–ª—å—à–∏–µ –æ–±—ä–µ–∫—Ç—ã –≤ –∫–µ—à–µ
3. TTL —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π

**–†–µ—à–µ–Ω–∏–µ:**
- –£–º–µ–Ω—å—à–∏—Ç–µ TTL
- –û—á–∏—â–∞–π—Ç–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–ª—é—á–∏
- –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ —É–≤–µ–ª–∏—á–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ Redis

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ö–æ–¥ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
2. ‚úÖ –ù—É–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ Render
3. ‚úÖ –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ Redis –¥–æ—Å—Ç—É–ø–µ–Ω
4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –≤ Telegram WebApp
5. ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ú–∏–≥—Ä–∞—Ü–∏—è —Å Telegram CloudStorage –Ω–∞ Redis –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É —Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º –ø–æ—Å–ª–µ –∑–∞–∫—Ä—ã—Ç–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –¢–µ–ø–µ—Ä—å:

- ‚úÖ –ö–µ—à —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç Telegram
- ‚úÖ –ù–µ—Ç –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ Telegram API
- ‚úÖ –ë—ã—Å—Ç—Ä–µ–µ –∏ –Ω–∞–¥–µ–∂–Ω–µ–µ
- ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
