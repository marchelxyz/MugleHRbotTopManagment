# üöÄ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Redis

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
cd backend
pip install redis>=5.0.0 hiredis>=2.2.0
```

–ò–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –≤ `requirements.txt`:
```
redis>=5.0.0
hiredis>=2.2.0
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Redis

#### –í–∞—Ä–∏–∞–Ω—Ç A: –õ–æ–∫–∞–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

**Linux/Mac:**
```bash
# Ubuntu/Debian
sudo apt-get install redis-server

# Mac (Homebrew)
brew install redis

# –ó–∞–ø—É—Å–∫
redis-server
```

**Windows:**
```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ WSL –∏–ª–∏ Docker
docker run -d -p 6379:6379 redis:latest
```

#### –í–∞—Ä–∏–∞–Ω—Ç B: Redis Cloud (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)

1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ [Redis Cloud](https://redis.com/try-free/)
2. –°–æ–∑–¥–∞–π—Ç–µ –±–µ—Å–ø–ª–∞—Ç–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö (30MB –±–µ—Å–ø–ª–∞—Ç–Ω–æ)
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ URL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

#### –í–∞—Ä–∏–∞–Ω—Ç C: Docker (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π)

```bash
docker run -d \
  --name redis \
  -p 6379:6379 \
  redis:latest
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ `.env` —Ñ–∞–π–ª:

```env
# Redis URL (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ - –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∫–µ—à–∞)
REDIS_URL=redis://localhost:6379/0

# –î–ª—è Redis Cloud:
# REDIS_URL=redis://username:password@host:port
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ - –≤ –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:
```
‚úÖ Redis –ø–æ–¥–∫–ª—é—á–µ–Ω —É—Å–ø–µ—à–Ω–æ
```

–ï—Å–ª–∏ Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:
```
‚ö†Ô∏è Redis –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ... –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è.
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç–∞—Ç—å, –Ω–æ –±–µ–∑ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è.

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–¥–µ

### –ë–∞–∑–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä

```python
from redis_client import cache_get, cache_set, cache_delete, CacheKeys

# –ü–æ–ª—É—á–∏—Ç—å –∏–∑ –∫–µ—à–∞
data = await cache_get(CacheKeys.FEED_LATEST)
if data:
    return data

# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –∫–µ—à
await cache_set(CacheKeys.FEED_LATEST, data, ttl=30)

# –£–¥–∞–ª–∏—Ç—å –∏–∑ –∫–µ—à–∞
await cache_delete(CacheKeys.FEED_LATEST)
```

### –ü—Ä–∏–º–µ—Ä –≤ —Ä–æ—É—Ç–µ—Ä–µ

```python
@router.get("/transactions/feed")
async def get_feed(db: AsyncSession = Depends(get_db)):
    cache_key = CacheKeys.FEED_LATEST
    
    # –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –∏–∑ –∫–µ—à–∞
    cached = await cache_get(cache_key)
    if cached:
        return cached
    
    # –ï—Å–ª–∏ –Ω–µ—Ç - –ø–æ–ª—É—á–∞–µ–º –∏–∑ –ë–î
    data = await crud.get_feed(db)
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫–µ—à –Ω–∞ 30 —Å–µ–∫—É–Ω–¥
    await cache_set(cache_key, data, ttl=30)
    
    return data
```

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ TTL (–≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫–µ—à–∞)

| –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö | TTL | –ü—Ä–∏—á–∏–Ω–∞ |
|------------|-----|---------|
| Feed —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π | 30 —Å–µ–∫ | –ß–∞—Å—Ç–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è |
| Leaderboard | 60 —Å–µ–∫ | –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ä–µ–∂–µ |
| Market Items | 300 —Å–µ–∫ (5 –º–∏–Ω) | –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ |
| Banners | 300 —Å–µ–∫ (5 –º–∏–Ω) | –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ |
| –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | 60 —Å–µ–∫ | –ú–æ–≥—É—Ç –∏–∑–º–µ–Ω—è—Ç—å—Å—è |

## –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞

**–í–ê–ñ–ù–û**: –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –Ω—É–∂–Ω–æ –æ—á–∏—â–∞—Ç—å –∫–µ—à!

```python
# –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
await cache_delete(CacheKeys.FEED_LATEST)
await cache_delete(CacheKeys.leaderboard('current_month', 'received'))

# –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
await cache_delete(CacheKeys.user_by_telegram(user_id))

# –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞
await cache_delete(CacheKeys.MARKET_ITEMS)
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã Redis

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Redis CLI
redis-cli

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –∫–ª—é—á–∏
KEYS *

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á
GET "feed:latest"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å TTL –∫–ª—é—á–∞
TTL "feed:latest"

# –£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∫–ª—é—á–∏ (–û–°–¢–û–†–û–ñ–ù–û!)
FLUSHALL
```

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

1. **Cache Hit Rate** - –ø—Ä–æ—Ü–µ–Ω—Ç –ø–æ–ø–∞–¥–∞–Ω–∏–π –≤ –∫–µ—à
   - –¶–µ–ª—å: > 70%
   - –§–æ—Ä–º—É–ª–∞: `hits / (hits + misses) * 100`

2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: `redis-cli INFO memory`
   - –¶–µ–ª—å: < 80% –æ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–π –ø–∞–º—è—Ç–∏

3. **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª—é—á–µ–π**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞: `redis-cli DBSIZE`

## Troubleshooting

### Redis –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∑–∞–ø—É—â–µ–Ω –ª–∏ Redis:
   ```bash
   redis-cli ping
   # –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å: PONG
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –≤ `.env`:
   ```env
   REDIS_URL=redis://localhost:6379/0
   ```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –í—ã—Å–æ–∫–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏

1. –£–º–µ–Ω—å—à–∏—Ç–µ TTL –¥–ª—è —Ä–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–æ–ª–µ–µ –∫–æ—Ä–æ—Ç–∫–∏–µ –∫–ª—é—á–∏
3. –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Redis —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º –ø–∞–º—è—Ç–∏

### –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ –≤ –∫–µ—à–µ

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ
2. –£–º–µ–Ω—å—à–∏—Ç–µ TTL –¥–ª—è —á–∞—Å—Ç–æ –∏–∑–º–µ–Ω—è–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
3. –î–æ–±–∞–≤—å—Ç–µ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–µ–π –∫–µ—à–∞

## –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

### 1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –¥–ª—è –º–∞—Å—Å–æ–≤–æ–π –æ—á–∏—Å—Ç–∫–∏

```python
# –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –∫–ª—é—á–∏ feed
await cache_delete_pattern("feed:*")

# –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –∫–ª—é—á–∏ leaderboard
await cache_delete_pattern("leaderboard:*")
```

### 2. –ö–æ–º–ø—Ä–µ—Å—Å–∏—è –¥–∞–Ω–Ω—ã—Ö

–î–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∂–∞—Ç–∏–µ (gzip), –Ω–æ —ç—Ç–æ –¥–æ–±–∞–≤–ª—è–µ—Ç CPU –Ω–∞–≥—Ä—É–∑–∫—É.

### 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Redis Pipeline

–î–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π:

```python
# –í–º–µ—Å—Ç–æ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤
for key in keys:
    await cache_delete(key)

# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ pipeline (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
# (—Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏ redis_client.py)
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **–ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ** –≤ Redis –±–µ–∑ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞—Ä–æ–ª—å** –¥–ª—è Redis –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ:
   ```env
   REDIS_URL=redis://:password@host:6379/0
   ```
3. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø** –∫ Redis —Ç–æ–ª—å–∫–æ —Å —Å–µ—Ä–≤–µ—Ä–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
4. **–†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ** Redis –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Redis
2. ‚úÖ –î–æ–±–∞–≤—å—Ç–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Å–∞–º—ã–µ —á–∞—Å—Ç—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
3. ‚úÖ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—é –∫–µ—à–∞
4. ‚úÖ –î–æ–±–∞–≤—å—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
5. ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ TTL –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–µ—Ç—Ä–∏–∫

## –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Redis Documentation](https://redis.io/docs/)
- [Redis Cloud](https://redis.com/try-free/)
- [Redis Best Practices](https://redis.io/docs/manual/patterns/)
