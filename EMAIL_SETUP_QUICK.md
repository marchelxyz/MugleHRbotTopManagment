# Быстрая настройка Email (Timeweb)

## Данные для настройки

- **SMTP сервер:** `smtp.timeweb.ru`
- **Порт:** `465` (SSL)
- **Email:** `support@teleagentnn.ru`
- **Пароль:** `j.IIaq-\Ydpm14`

## Настройка в .env файле

Добавьте в файл `backend/.env` следующие строки:

```env
# Настройки SMTP Timeweb
SMTP_HOST=smtp.timeweb.ru
SMTP_PORT=465
SMTP_USERNAME=support@teleagentnn.ru
SMTP_PASSWORD="j.IIaq-\\Ydpm14"
SMTP_USE_TLS=false

# Email адреса администраторов (куда приходят уведомления о регистрациях)
ADMIN_EMAILS=support@teleagentnn.ru

# URL страницы входа в веб-приложение (если есть)
WEB_APP_LOGIN_URL=https://your-app.com
```

## ⚠️ Важно

1. **Пароль в кавычках:** Если пароль содержит специальные символы (`\`, `-`, `.`), обязательно оберните его в двойные кавычки и удвойте обратный слэш: `"j.IIaq-\\Ydpm14"`

2. **Правильный хост:** Используйте `smtp.timeweb.ru` (с `.ru`), а не `smtp.timeweb.com` (`.com` не работает)

3. **Перезапуск:** После изменения `.env` файла перезапустите приложение

## Проверка работы

После настройки при регистрации нового пользователя:
- Администраторам придет email уведомление на адреса из `ADMIN_EMAILS`
- При одобрении регистрации пользователю придет email с логином и паролем

## Устранение проблем

Если письма не отправляются и вы видите ошибку `SMTPAuthenticationError: (535, 'Incorrect authentication data')`:

### 1. Проверка учетных данных

**Проверьте SMTP_USERNAME:**
- Должен быть полным email адресом (например: `support@teleagentnn.ru`)
- Не должен содержать пробелов в начале или конце
- Пример правильного формата: `SMTP_USERNAME=support@teleagentnn.ru`

**Проверьте SMTP_PASSWORD:**
- Пароль должен быть правильно экранирован в `.env` файле
- Если пароль содержит спецсимволы (`\`, `-`, `.`, `#`, `$`, `%`, `&`), оберните его в кавычки:
  - Правильно: `SMTP_PASSWORD="j.IIaq-\\Ydpm14"`
  - Неправильно: `SMTP_PASSWORD=j.IIaq-\Ydpm14`
- Убедитесь, что пароль не содержит пробелов в начале или конце
- Проверьте длину пароля в логах (должна соответствовать реальной длине)

### 2. Проверка настроек в .env

Убедитесь, что в `.env` файле:
```env
SMTP_HOST=smtp.timeweb.ru
SMTP_PORT=465
SMTP_USERNAME=support@teleagentnn.ru
SMTP_PASSWORD="j.IIaq-\\Ydpm14"  # В кавычках, с удвоенным обратным слэшем
SMTP_USE_TLS=false
```

### 3. Диагностика

Проверьте логи приложения - теперь они содержат подробную информацию:
- Длина пароля (для проверки, что пароль прочитан правильно)
- Email адрес для аутентификации
- Детали ошибки аутентификации

### 4. Другие проверки

1. Проверьте DNS: `nslookup smtp.timeweb.ru` - должен вернуть IP адреса
2. Убедитесь, что почтовый ящик активен в панели Timeweb
3. Проверьте, что пароль правильный (попробуйте войти через веб-интерфейс Timeweb)
4. Убедитесь, что в панели Timeweb включена возможность отправки через SMTP
5. Перезапустите приложение после изменения `.env` файла
