import{b as D,r as i,j as e,m as P}from"./react-vendor-CTCOu_cH.js";import{g as I,a as E,b as $}from"./index-DWD9sWeV.js";import{f as A,a as L}from"./dateFormatter-NZopE8Q3.js";import"./vendor-62T33e3N.js";import"./lottie-vendor-CdbPF2lo.js";import"./date-vendor-BIBOd_sa.js";import"./chart-vendor-CqyaVfOQ.js";import"./axios-vendor-D5lHaTRS.js";const W="_pageContainer_lm9n7_3",z="_headerWrapper_lm9n7_13",R="_header_lm9n7_13",G="_contentArea_lm9n7_31",M="_userBlock_lm9n7_45",H="_userAvatar_lm9n7_78",O="_userName_lm9n7_85",Y="_thankYouButton_lm9n7_112",U="_sliderContainer_lm9n7_124",Q="_sliderArrowLeft_lm9n7_139",X="_sliderArrowRight_lm9n7_140",K="_sliderTrack_lm9n7_180",V="_slide_lm9n7_124",Z="_bannerImage_lm9n7_190",q="_sliderDots_lm9n7_196",J="_dot_lm9n7_205",ee="_dotActive_lm9n7_214",te="_photoFeed_lm9n7_219",se="_photoFeedTrack_lm9n7_251",ne="_photoPlaceholder_lm9n7_270",ae="_photoFeedImage_lm9n7_279",oe="_feedSection_lm9n7_286",re="_feedTitle_lm9n7_321",le="_feedGrid_lm9n7_329",ie="_dateHeader_lm9n7_336",ce="_feedItem_lm9n7_352",de="_feedItemLogo_lm9n7_365",me="_feedItemContent_lm9n7_372",_e="_feedTransaction_lm9n7_378",pe="_arrow_lm9n7_386",he="_feedMessage_lm9n7_390",ue="_feedTimestamp_lm9n7_398",fe="_headerDesktop_lm9n7_521",ge="_active_lm9n7_614",s={pageContainer:W,headerWrapper:z,header:R,contentArea:G,userBlock:M,userAvatar:H,userName:O,thankYouButton:Y,sliderContainer:U,sliderArrowLeft:Q,sliderArrowRight:X,sliderTrack:K,slide:V,bannerImage:Z,sliderDots:q,dot:J,dotActive:ee,photoFeed:te,photoFeedTrack:se,photoPlaceholder:ne,photoFeedImage:ae,feedSection:oe,feedTitle:re,feedGrid:le,dateHeader:ie,feedItem:ce,feedItemLogo:de,feedItemContent:me,feedTransaction:_e,arrow:pe,feedMessage:he,feedTimestamp:ue,headerDesktop:fe,active:ge},ve="_bannerBox_t1egn_1",be="_title_t1egn_18",xe="_podium_t1egn_25",je="_podiumItem_t1egn_33",Ne="_place1_t1egn_41",ye="_place2_t1egn_42",Ce="_place3_t1egn_43",we="_podiumIcon_t1egn_45",ke="_podiumAvatar_t1egn_50",Fe="_podiumName_t1egn_62",Be="_podiumPoints_t1egn_72",Te="_navButton_t1egn_78",d={bannerBox:ve,title:be,podium:xe,podiumItem:je,place1:Ne,place2:ye,place3:Ce,podiumIcon:we,podiumAvatar:ke,podiumName:Fe,podiumPoints:Be,navButton:Te},Ie={1:"#FFD700",2:"#C0C0C0",3:"#CD7F32"};function Ae({banner:b,onNavigate:h}){const{banner_type:u,data:c,link_url:l}=b,f=i.useMemo(()=>(c==null?void 0:c.users)||[],[c==null?void 0:c.users]),m=i.useMemo(()=>u==="leaderboard_receivers"?"Лидеры прошлого месяца":"Самые щедрые (прошлый месяц)",[u]),x=i.useCallback(()=>{l&&l.startsWith("/")&&h(l.replace("/",""))},[l,h]);return e.jsxs("div",{className:d.bannerBox,children:[e.jsx("h4",{className:d.title,children:m}),e.jsx("div",{className:d.podium,children:f.map(a=>e.jsxs("div",{className:`${d.podiumItem} ${d[`place${a.rank}`]}`,children:[e.jsx(P,{className:d.podiumIcon,color:Ie[a.rank]}),e.jsx("img",{src:a.telegram_photo_url||"placeholder.png",alt:a.first_name,className:d.podiumAvatar,loading:"lazy",decoding:"async",width:"60",height:"60"}),e.jsx("div",{className:d.podiumName,children:a.first_name}),e.jsx("div",{className:d.podiumPoints,children:a.total_received})]},a.rank))}),e.jsx("button",{className:d.navButton,onClick:x,children:"Посмотреть весь рейтинг"})]})}const De=D.memo(Ae),Se="_garland_1i3nz_3",Pe="_wireContainer_1i3nz_15",Ee="_wire_1i3nz_15",$e="_wirePath_1i3nz_33",Le="_bulbsContainer_1i3nz_51",We="_bulbWrapper_1i3nz_60",ze="_bulb_1i3nz_51",Re="_bulbCore_1i3nz_75",Ge="_bulbGlow_1i3nz_92",p={garland:Se,wireContainer:Pe,wire:Ee,wirePath:$e,bulbsContainer:Le,bulbWrapper:We,bulb:ze,bulbCore:Re,bulbGlow:Ge};function Me(){const b=[{color:"#FF6B6B",delay:0},{color:"#4ECDC4",delay:.2},{color:"#FFE66D",delay:.4},{color:"#95E1D3",delay:.6},{color:"#F38181",delay:.8},{color:"#AA96DA",delay:1},{color:"#FCBAD3",delay:1.2},{color:"#FFD93D",delay:1.4},{color:"#6BCB77",delay:1.6},{color:"#4D96FF",delay:1.8},{color:"#FF6B9D",delay:2},{color:"#C44569",delay:2.2},{color:"#F8B500",delay:2.4},{color:"#A8E6CF",delay:2.6},{color:"#FFD3A5",delay:2.8},{color:"#FD9853",delay:3}],h=1e3,u=b.length,[c,l]=i.useState([]),[f,m]=i.useState(1);i.useEffect(()=>{const a=()=>{const j=window.innerWidth,_=Math.ceil(j/h);m(_);const g=[];for(let o=0;o<_;o++)b.forEach((r,y)=>{const k=o*u+y,N=y/(u-1),C=(o+N)/_;g.push({...r,key:k,position:C*100,delay:r.delay+o*3.2})});l(g)};return a(),window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]);const x=Array.from({length:f},(a,j)=>j);return e.jsxs("div",{className:p.garland,children:[e.jsx("div",{className:p.wireContainer,children:x.map(a=>e.jsx("svg",{className:p.wire,viewBox:"0 0 1000 50",preserveAspectRatio:"none",style:{width:`${100/f}%`,left:`${a*100/f}%`},children:e.jsx("path",{d:"M 0,25 Q 250,5 500,25 T 1000,25",fill:"none",stroke:"#FFD700",strokeWidth:"2",className:p.wirePath})},a))}),e.jsx("div",{className:p.bulbsContainer,children:c.map(a=>e.jsx("div",{className:p.bulbWrapper,style:{left:`${a.position}%`},children:e.jsxs("div",{className:p.bulb,style:{"--bulb-color":a.color,"--animation-delay":`${a.delay}s`},children:[e.jsx("div",{className:p.bulbGlow}),e.jsx("div",{className:p.bulbCore})]})},a.key))})]})}function Ze({user:b,onNavigate:h,telegramPhotoUrl:u,isDesktop:c}){const[l,f]=i.useState(()=>I("feed")),[m,x]=i.useState(()=>I("banners")||[]),[a,j]=i.useState(!l),[_,g]=i.useState(0),o=i.useRef(null);i.useEffect(()=>{(async()=>{if(!m||m.length===0)try{const n=await E();x(n.data)}catch{}if(!l)try{const n=await $();f(n.data)}catch{}j(!1)})()},[l,m]);const r=m.filter(t=>t.position==="main"),y=()=>{r.length>1&&(o.current&&clearTimeout(o.current),g(t=>(t+1)%r.length))},k=()=>{r.length>1&&(o.current&&clearTimeout(o.current),g(t=>(t-1+r.length)%r.length))};i.useEffect(()=>{if(r.length>1){o.current&&clearTimeout(o.current);const t=setTimeout(()=>{g(n=>(n+1)%r.length)},5e3);return o.current=t,()=>{o.current&&clearTimeout(o.current)}}},[_,r.length]);const N=m.filter(t=>t.position==="feed"),C=t=>{t&&(t.startsWith("/")?h(t.replace("/","")):window.open(t,"_blank","noopener,noreferrer"))},w=i.useMemo(()=>!l||l.length===0?{}:l.reduce((t,n)=>{const v=A(n.timestamp,{year:void 0,month:void 0,day:void 0,hour:void 0,minute:void 0});return t[v]||(t[v]=[]),t[v].push(n),t},{}),[l]),S=()=>c?`translateX(${8-_*84}%)`:`translateX(-${_*100}%)`;return e.jsxs("div",{className:s.pageContainer,children:[e.jsx("div",{className:s.headerWrapper,children:e.jsx("div",{className:c?s.headerDesktop:s.header})}),e.jsxs("div",{className:s.contentArea,children:[e.jsxs("div",{className:s.userBlock,children:[e.jsx(Me,{}),e.jsx("img",{src:u||"placeholder.png",alt:"User",className:s.userAvatar,loading:"eager",decoding:"async",width:"60",height:"60"}),e.jsx("span",{className:s.userName,children:b.first_name}),e.jsx("img",{src:"https://i.postimg.cc/kgrZQyKK/knopka-otpr-sp-sinaa.webp",alt:"Отправить спасибки",className:s.thankYouButton,loading:"eager",decoding:"async",onClick:()=>h("transfer")})]}),r.length>0&&e.jsxs("div",{className:s.sliderContainer,children:[r.length>1&&e.jsx("button",{className:s.sliderArrowLeft,onClick:k,"aria-label":"Предыдущий баннер",children:"‹"}),e.jsx("div",{className:s.sliderTrack,style:{transform:S()},children:r.map((t,n)=>e.jsx("div",{className:`${s.slide} ${_===n?s.active:""}`,onClick:()=>(t.banner_type==="image"||!t.banner_type)&&C(t.link_url),children:t.banner_type==="image"||!t.banner_type?e.jsx("img",{src:t.image_url,alt:"Banner",className:s.bannerImage}):e.jsx(De,{banner:t,onNavigate:h})},t.id))}),r.length>1&&e.jsx("button",{className:s.sliderArrowRight,onClick:y,"aria-label":"Следующий баннер",children:"›"}),r.length>1&&e.jsx("div",{className:s.sliderDots,children:r.map((t,n)=>e.jsx("div",{className:`${s.dot} ${_===n?s.dotActive:""}`,onClick:()=>{o.current&&clearTimeout(o.current),g(n)}},n))})]}),N.length>0&&e.jsx("div",{className:s.photoFeed,children:e.jsx("div",{className:s.photoFeedTrack,children:[...N,...N].map((t,n)=>e.jsx("div",{className:s.photoPlaceholder,onClick:()=>C(t.link_url),children:e.jsx("img",{src:t.image_url,alt:"Photo feed banner",className:s.photoFeedImage,loading:"lazy"})},`${t.id}-${n}`))})}),e.jsxs("div",{className:s.feedSection,children:[e.jsx("h3",{className:s.feedTitle,children:"Последняя активность"}),e.jsx("div",{className:s.feedGrid,children:a?e.jsx("p",{children:"Загрузка..."}):Object.keys(w).length>0?Object.keys(w).map(t=>e.jsxs(D.Fragment,{children:[e.jsx("div",{className:s.dateHeader,children:e.jsx("span",{children:L(w[t][0].timestamp)})}),w[t].map(n=>{var v,F,B,T;return e.jsxs("div",{className:s.feedItem,children:[e.jsx("img",{src:"https://i.postimg.cc/L5j1PRjr/LOGO-SP-UVED-SIN.webp",alt:"feed logo",className:s.feedItemLogo,loading:"lazy"}),e.jsxs("div",{className:s.feedItemContent,children:[e.jsxs("p",{className:s.feedTransaction,children:["@",((v=n.sender)==null?void 0:v.username)||((F=n.sender)==null?void 0:F.first_name)||"Неизвестно"," ",e.jsx("span",{className:s.arrow,children:"→"})," @",((B=n.receiver)==null?void 0:B.username)||((T=n.receiver)==null?void 0:T.first_name)||"Неизвестно"]}),e.jsxs("p",{className:s.feedMessage,children:[n.amount," спасибо - ",n.message]})]}),e.jsx("div",{className:s.feedTimestamp,children:A(n.timestamp,{year:void 0,month:void 0,day:void 0})})]},n.id)})]},t)):e.jsx("p",{children:"Лента активности пуста."})})]})]})]})}export{Ze as default};
