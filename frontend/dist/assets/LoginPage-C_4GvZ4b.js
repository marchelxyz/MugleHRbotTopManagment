import{r as i,j as e,k as E,l as F}from"./react-vendor-CTCOu_cH.js";import{u as I,l as $}from"./index-DWD9sWeV.js";import"./vendor-62T33e3N.js";import"./lottie-vendor-CdbPF2lo.js";import"./date-vendor-BIBOd_sa.js";import"./chart-vendor-CqyaVfOQ.js";import"./axios-vendor-D5lHaTRS.js";const D="_page_eli6k_3",M="_loginContainer_eli6k_22",T="_subtitle_eli6k_34",q="_form_eli6k_42",R="_input_eli6k_46",A="_submitButton_eli6k_64",O="_error_eli6k_95",U="_registerLink_eli6k_104",J="_linkButton_eli6k_110",W="_passwordContainer_eli6k_130",z="_eyeButton_eli6k_141",G="_forgotPasswordLink_eli6k_167",H="_forgotPasswordButton_eli6k_173",K="_forgotPasswordModal_eli6k_189",Q="_forgotPasswordContent_eli6k_205",V="_forgotPasswordText_eli6k_224",X="_forgotPasswordButtons_eli6k_231",Y="_cancelButton_eli6k_238",t={page:D,loginContainer:M,subtitle:T,form:q,input:R,submitButton:A,error:O,registerLink:U,linkButton:J,passwordContainer:W,eyeButton:z,forgotPasswordLink:G,forgotPasswordButton:H,forgotPasswordModal:K,forgotPasswordContent:Q,forgotPasswordText:V,forgotPasswordButtons:X,cancelButton:Y};var C;const c=!((C=window.Telegram)!=null&&C.WebApp);function re({onLoginSuccess:f,onShowRegistration:w}){const{showAlert:d}=I(),[a,h]=i.useState({login:"",password:""}),[m,P]=i.useState({}),[_,x]=i.useState(!1),[g,y]=i.useState(!1),[N,b]=i.useState(!1),[n,k]=i.useState({fio:"",phone:"",department:"",position:"",balance:""});i.useEffect(()=>{const o=sessionStorage.getItem("pendingLoginCredentials");if(o)try{const s=JSON.parse(o);s.login&&s.password&&(h({login:s.login,password:s.password}),sessionStorage.removeItem("pendingLoginCredentials"),d("Данные для входа автоматически заполнены","success"))}catch{sessionStorage.removeItem("pendingLoginCredentials")}},[d]);const j=o=>{const{name:s,value:r}=o.target;h(l=>({...l,[s]:r}))},u=o=>{const{name:s,value:r}=o.target;k(l=>({...l,[s]:r}))},B=o=>{o.preventDefault();const s=encodeURIComponent("Восстановление логина и пароля в Спасибо"),r=encodeURIComponent(`ФИО: ${n.fio}
Номер телефона: ${n.phone}
Подразделение: ${n.department}
Должность: ${n.position}
Примерное количество спасибок на балансе: ${n.balance}`);window.location.href=`mailto:masovroma@gmail.com?subject=${s}&body=${r}`},v=o=>{o.preventDefault(),o.stopPropagation(),w&&w()},S=()=>{const o={};return a.login.trim()||(o.login=c?"Email обязателен":"Логин обязателен"),c&&a.login.trim()&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.login.trim())||(o.login="Введите корректный email")),a.password.trim()||(o.password="Пароль обязателен"),P(o),Object.keys(o).length===0},L=async o=>{var s,r;if(o.preventDefault(),!S()){d("Пожалуйста, заполните все поля.","error");return}x(!0);try{const p=(await $(a.login,a.password)).data;localStorage.setItem("userId",p.id.toString()),localStorage.setItem("user",JSON.stringify(p)),d("Вход выполнен успешно!","success"),setTimeout(()=>{f?f(p):window.location.reload()},1500)}catch(l){const p=((r=(s=l.response)==null?void 0:s.data)==null?void 0:r.detail)||"Не удалось войти. Проверьте логин и пароль.";d(p,"error")}finally{x(!1)}};return e.jsxs("div",{className:t.page,children:[e.jsxs("div",{className:t.loginContainer,children:[e.jsx("p",{className:t.subtitle,children:c?"Войдите в систему, используя ваш email и пароль":"Войдите в систему, используя ваш логин и пароль"}),e.jsxs("form",{onSubmit:L,className:t.form,children:[e.jsx("input",{name:"login",type:c?"email":"text",value:a.login,onChange:j,placeholder:c?"Email":"Логин",className:t.input,autoComplete:c?"email":"username"}),m.login&&e.jsx("p",{className:t.error,children:m.login}),e.jsxs("div",{className:t.passwordContainer,children:[e.jsx("input",{name:"password",type:g?"text":"password",value:a.password,onChange:j,placeholder:"Пароль",className:t.input,autoComplete:"current-password"}),e.jsx("button",{type:"button",className:t.eyeButton,onClick:()=>y(!g),"aria-label":g?"Скрыть пароль":"Показать пароль",children:g?e.jsx(E,{}):e.jsx(F,{})})]}),m.password&&e.jsx("p",{className:t.error,children:m.password}),e.jsx("div",{className:t.forgotPasswordLink,children:e.jsx("button",{type:"button",onClick:()=>b(!0),className:t.forgotPasswordButton,children:"Забыли пароль?"})}),e.jsx("button",{type:"submit",disabled:_,className:t.submitButton,children:_?"Вход...":"Войти"})]}),e.jsx("div",{className:t.registerLink,children:e.jsxs("p",{children:["Нет аккаунта? ",e.jsx("button",{type:"button",onClick:v,className:t.linkButton,children:"Зарегистрироваться"})]})})]}),N&&e.jsx("div",{className:t.forgotPasswordModal,children:e.jsxs("div",{className:t.forgotPasswordContent,children:[e.jsx("h2",{children:"Восстановление доступа"}),e.jsx("p",{className:t.forgotPasswordText,children:"Заполните форму ниже, и мы откроем почтовый клиент для отправки запроса на восстановление доступа."}),e.jsxs("form",{onSubmit:B,children:[e.jsx("input",{name:"fio",type:"text",value:n.fio,onChange:u,placeholder:"ФИО",className:t.input,required:!0}),e.jsx("input",{name:"phone",type:"tel",value:n.phone,onChange:u,placeholder:"Номер телефона",className:t.input,required:!0}),e.jsx("input",{name:"department",type:"text",value:n.department,onChange:u,placeholder:"Подразделение",className:t.input,required:!0}),e.jsx("input",{name:"position",type:"text",value:n.position,onChange:u,placeholder:"Должность",className:t.input,required:!0}),e.jsx("input",{name:"balance",type:"text",value:n.balance,onChange:u,placeholder:"Примерное количество спасибок на балансе",className:t.input,required:!0}),e.jsxs("div",{className:t.forgotPasswordButtons,children:[e.jsx("button",{type:"submit",className:t.submitButton,children:"Открыть почту"}),e.jsx("button",{type:"button",onClick:()=>{b(!1),k({fio:"",phone:"",department:"",position:"",balance:""})},className:t.cancelButton,children:"Отмена"})]})]})]})})]})}export{re as default};
