import{r as x,j as e,I as N}from"./react-vendor-CTCOu_cH.js";import{u as _,r as g}from"./index-DWD9sWeV.js";import{s as a}from"./RegistrationPage.module-DMDi5ndb.js";import{P as D}from"./PageLayout-BcvhvPkp.js";import"./vendor-62T33e3N.js";import"./lottie-vendor-CdbPF2lo.js";import"./date-vendor-BIBOd_sa.js";import"./chart-vendor-CqyaVfOQ.js";import"./axios-vendor-D5lHaTRS.js";const y=n=>{if(!n||n.includes("_"))return null;const u=n.split(".");if(u.length===3){const[m,d,o]=u;return`${o}-${d}-${m}`}return null};function L({telegramUser:n,onRegistrationSuccess:u,isWebBrowser:m=!1,onBackToLogin:d}){const{showAlert:o}=_(),[t,v]=x.useState({firstName:(n==null?void 0:n.first_name)||"",lastName:"",department:"",position:"",phoneNumber:"",dateOfBirth:"",email:""}),[s,C]=x.useState({}),[h,j]=x.useState(!1),r=i=>{const{name:p,value:l}=i.target;v(c=>({...c,[p]:l}))},O=()=>{const i={};return t.firstName.trim()||(i.firstName="Имя обязательно"),t.lastName.trim()||(i.lastName="Фамилия обязательна"),t.department.trim()||(i.department="Подразделение обязательно"),t.position.trim()||(i.position="Должность обязательна"),t.phoneNumber.includes("_")&&(i.phoneNumber="Введите телефон полностью"),t.dateOfBirth.includes("_")&&(i.dateOfBirth="Введите дату полностью"),m?t.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.email.trim())||(i.email="Введите корректный email"):i.email="Email обязателен":t.email.trim()&&(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.email.trim())||(i.email="Введите корректный email")),!y(t.dateOfBirth)&&!t.dateOfBirth.includes("_")&&(i.dateOfBirth="Неверный формат даты"),C(i),Object.keys(i).length===0},b=async i=>{var p,l;if(i.preventDefault(),!O()){o("Пожалуйста, заполните все обязательные поля корректно.","error");return}j(!0);try{const c=y(t.dateOfBirth),f=m?null:n==null?void 0:n.id,B={telegram_id:f?String(f):null,first_name:t.firstName,last_name:t.lastName,department:t.department,position:t.position,username:(n==null?void 0:n.username)||null,telegram_photo_url:(n==null?void 0:n.photo_url)||null,phone_number:t.phoneNumber,date_of_birth:c,email:t.email.trim()||null};await g(f||"",B),o("Ваша заявка отправлена на рассмотрение!","success"),setTimeout(()=>{u()},1500)}catch(c){o(((l=(p=c.response)==null?void 0:p.data)==null?void 0:l.detail)||"Не удалось отправить заявку.","error")}finally{j(!1)}};return m?e.jsx("div",{className:a.page,children:e.jsxs("div",{className:a.registrationContainer,children:[d&&e.jsx("button",{onClick:d,className:a.backButton,children:"← Назад к входу"}),e.jsx("p",{className:a.subtitle,children:"Для регистрации в приложении, пожалуйста, укажите вашу информацию. После регистрации ваша заявка будет рассмотрена администратором."}),e.jsxs("form",{onSubmit:b,className:a.form,children:[e.jsx("input",{name:"firstName",type:"text",value:t.firstName,onChange:r,placeholder:"Ваше имя",className:a.input}),s.firstName&&e.jsx("p",{className:a.error,children:s.firstName}),e.jsx("input",{name:"lastName",type:"text",value:t.lastName,onChange:r,placeholder:"Ваша фамилия",className:a.input}),s.lastName&&e.jsx("p",{className:a.error,children:s.lastName}),e.jsx("input",{name:"department",type:"text",value:t.department,onChange:r,placeholder:"Ваше подразделение",className:a.input}),s.department&&e.jsx("p",{className:a.error,children:s.department}),e.jsx("input",{name:"position",type:"text",value:t.position,onChange:r,placeholder:"Ваша должность",className:a.input}),s.position&&e.jsx("p",{className:a.error,children:s.position}),e.jsx("input",{name:"email",type:"email",value:t.email,onChange:r,placeholder:"Email",className:a.input}),s.email&&e.jsx("p",{className:a.error,children:s.email}),e.jsx(N,{mask:"+7 (999) 999-99-99",name:"phoneNumber",value:t.phoneNumber,onChange:r,className:a.input,children:i=>e.jsx("input",{...i,type:"tel",placeholder:"Номер телефона"})}),s.phoneNumber&&e.jsx("p",{className:a.error,children:s.phoneNumber}),e.jsx(N,{mask:"99.99.9999",name:"dateOfBirth",value:t.dateOfBirth,onChange:r,className:a.input,children:i=>e.jsx("input",{...i,type:"text",placeholder:"Дата рождения (ДД.ММ.ГГГГ)"})}),s.dateOfBirth&&e.jsx("p",{className:a.error,children:s.dateOfBirth}),e.jsx("button",{type:"submit",disabled:h,className:a.submitButton,children:h?"Отправка...":"Отправить на рассмотрение"})]})]})}):e.jsxs(D,{title:"Регистрация",children:[e.jsxs("div",{className:a.subtitle,children:[e.jsx("p",{children:`Привет, ${(n==null?void 0:n.first_name)||"пользователь"}! Для завершения настройки, пожалуйста, укажите вашу информацию.`}),e.jsx("p",{style:{marginTop:"10px",fontSize:"0.9em",color:"#666"},children:"Если у вас уже есть аккаунт в веб-версии, укажите ваш email для автоматического связывания аккаунтов."})]}),e.jsxs("form",{onSubmit:b,className:a.form,children:[e.jsx("input",{name:"firstName",type:"text",value:t.firstName,onChange:r,placeholder:"Ваше имя",className:a.input}),s.firstName&&e.jsx("p",{className:a.error,children:s.firstName}),e.jsx("input",{name:"lastName",type:"text",value:t.lastName,onChange:r,placeholder:"Ваша фамилия",className:a.input}),s.lastName&&e.jsx("p",{className:a.error,children:s.lastName}),e.jsx("input",{name:"department",type:"text",value:t.department,onChange:r,placeholder:"Ваше подразделение",className:a.input}),s.department&&e.jsx("p",{className:a.error,children:s.department}),e.jsx("input",{name:"position",type:"text",value:t.position,onChange:r,placeholder:"Ваша должность",className:a.input}),s.position&&e.jsx("p",{className:a.error,children:s.position}),e.jsx("input",{name:"email",type:"email",value:t.email,onChange:r,placeholder:"Email (опционально, если есть веб-аккаунт)",className:a.input}),s.email&&e.jsx("p",{className:a.error,children:s.email}),e.jsx(N,{mask:"+7 (999) 999-99-99",name:"phoneNumber",value:t.phoneNumber,onChange:r,className:a.input,children:i=>e.jsx("input",{...i,type:"tel",placeholder:"Номер телефона"})}),s.phoneNumber&&e.jsx("p",{className:a.error,children:s.phoneNumber}),e.jsx(N,{mask:"99.99.9999",name:"dateOfBirth",value:t.dateOfBirth,onChange:r,className:a.input,children:i=>e.jsx("input",{...i,type:"text",placeholder:"Дата рождения (ДД.ММ.ГГГГ)"})}),s.dateOfBirth&&e.jsx("p",{className:a.error,children:s.dateOfBirth}),e.jsx("button",{type:"submit",disabled:h,className:a.submitButton,children:h?"Отправка...":"Отправить на рассмотрение"})]})]})}export{L as default};
