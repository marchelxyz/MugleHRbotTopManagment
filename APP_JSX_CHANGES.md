# üìù –û–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ App.jsx

## üéØ –¶–µ–ª—å –∏–∑–º–µ–Ω–µ–Ω–∏–π

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º Telegram –ø–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞ –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö —Å–æ–≥–ª–∞—Å–Ω–æ **–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Telegram Web Apps**.

## üìö –ò—Å—Ç–æ—á–Ω–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:
- https://core.telegram.org/bots/webapps
- Bot API 8.0+ —Å–æ–±—ã—Ç–∏—è: `activated`, `deactivated`
- –°–æ–±—ã—Ç–∏–µ `viewportChanged` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `isStateStable`
- –ü–æ–ª–µ `isActive` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è Mini App

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp (—Å—Ç—Ä–æ–∫–∏ 64-120)

#### ‚ùå –ë—ã–ª–æ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
```javascript
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–æ–±—ã—Ç–∏—è
tg.onEvent('viewportChanged', (event) => {
  if (event.isStateVisible) { // ‚ùå –¢–∞–∫–æ–≥–æ –ø–æ–ª—è –Ω–µ—Ç –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
    tg.expand();
    tg.ready();
  }
});

tg.onEvent('visibilityChanged', (event) => { // ‚ùå –¢–∞–∫–æ–≥–æ —Å–æ–±—ã—Ç–∏—è –Ω–µ—Ç
  if (event.isVisible) {
    tg.expand();
    tg.ready();
  }
});
```

#### ‚úÖ –°—Ç–∞–ª–æ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
```javascript
// ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è activated/deactivated (Bot API 8.0+)
if (tg.isVersionAtLeast && tg.isVersionAtLeast('8.0')) {
  // –°–æ–±—ã—Ç–∏–µ activated - –∫–æ–≥–¥–∞ Mini App —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ–π
  tg.onEvent('activated', () => {
    console.log('Mini App –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ - –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ');
    tg.expand();
    tg.ready(); // –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ Telegram WebApp
    tg.setHeaderColor('#2196F3');
    tg.setBackgroundColor('#E8F4F8');
  });
  
  // –°–æ–±—ã—Ç–∏–µ deactivated - –∫–æ–≥–¥–∞ Mini App —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–π
  tg.onEvent('deactivated', () => {
    console.log('Mini App –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ - –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–ø–µ—Ä–∞—Ü–∏–∏');
  });
}

// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ viewportChanged
tg.onEvent('viewportChanged', (event) => {
  if (event.isStateStable) { // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–ª–µ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
    console.log('Viewport —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è');
    if (tg.isActive !== undefined && tg.isActive) {
      // Mini App –∞–∫—Ç–∏–≤–Ω–∞
    }
  }
});
```

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–µ—Å—Å–∏–π (—Å—Ç—Ä–æ–∫–∏ 305-400)

#### ‚ùå –ë—ã–ª–æ (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
```javascript
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å —Ç–æ–ª—å–∫–æ –±—Ä–∞—É–∑–µ—Ä–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
const handleVisibilityChange = () => {
  if (document.visibilityState === 'visible') {
    // ...
  }
};
document.addEventListener('visibilitychange', handleVisibilityChange);

// –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è
tg.onEvent('close', handleClose); // ‚ùå –°–æ–±—ã—Ç–∏—è close –Ω–µ—Ç –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
```

#### ‚úÖ –°—Ç–∞–ª–æ (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
```javascript
// ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è Telegram WebApp API
if (tg && tg.onEvent && tg.isVersionAtLeast && tg.isVersionAtLeast('8.0')) {
  // –°–æ–±—ã—Ç–∏–µ activated - –∫–æ–≥–¥–∞ Mini App —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ–π
  tg.onEvent('activated', () => {
    console.log('Mini App –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ - –≤–æ–∑–æ–±–Ω–æ–≤–ª—è–µ–º —Å–µ—Å—Å–∏—é');
    isActive = true;
    if (!intervalId && sessionId) {
      startPinging();
    }
  });
  
  // –°–æ–±—ã—Ç–∏–µ deactivated - –∫–æ–≥–¥–∞ Mini App —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–π
  tg.onEvent('deactivated', () => {
    console.log('Mini App –¥–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ - –ø—Ä–∏–æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ—Å—Å–∏—é');
    isActive = false;
  });
} else {
  // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏–π
  const handleVisibilityChange = () => {
    // ...
  };
  document.addEventListener('visibilitychange', handleVisibilityChange);
}
```

## üîç –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π Telegram

| –°–æ–±—ã—Ç–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ | –í–µ—Ä—Å–∏—è |
|---------|----------|--------|
| `activated` | Mini App —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ–π | Bot API 8.0+ |
| `deactivated` | Mini App —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–π | Bot API 8.0+ |
| `viewportChanged` | –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ–π —Å–µ–∫—Ü–∏–∏ | –í—Å–µ –≤–µ—Ä—Å–∏–∏ |

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ API

```javascript
if (tg.isVersionAtLeast && tg.isVersionAtLeast('8.0')) {
  // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è
} else {
  // Fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏–π
}
```

### 3. –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ viewportChanged

```javascript
tg.onEvent('viewportChanged', (event) => {
  if (event.isStateStable) { // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø–æ–ª–µ
    // Viewport —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞–ª—Å—è
  }
});
```

### 4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ–ª—è isActive

```javascript
if (tg.isActive !== undefined && tg.isActive) {
  // Mini App –∞–∫—Ç–∏–≤–Ω–∞
}
```

## üìã –ß—Ç–æ –±—ã–ª–æ —É–¥–∞–ª–µ–Ω–æ

1. ‚ùå –°–æ–±—ã—Ç–∏–µ `visibilityChanged` - –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
2. ‚ùå –ü—Ä–æ–≤–µ—Ä–∫–∞ `event.isStateVisible` - —Ç–∞–∫–æ–≥–æ –ø–æ–ª—è –Ω–µ—Ç
3. ‚ùå –°–æ–±—ã—Ç–∏–µ `close` - –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
4. ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ `viewportChanged`

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

1. ‚úÖ –°–æ–±—ã—Ç–∏–µ `activated` - –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ Telegram
2. ‚úÖ –°–æ–±—ã—Ç–∏–µ `deactivated` - –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ Telegram
3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ API –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
4. ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ `viewportChanged` —Å `isStateStable`
5. ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ–ª—è `isActive` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è
6. ‚úÖ Fallback –Ω–∞ `visibilitychange` –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏–π

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å –∫–æ–¥:
- ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Telegram
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∞–∫—Ç–∏–≤–∞—Ü–∏—é/–¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—é Mini App
- ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –∏–∑ —Ñ–æ–Ω–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –Ω–∞ –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏—è—Ö (Bot API 8.0+), —Ç–∞–∫ –∏ –Ω–∞ —Å—Ç–∞—Ä—ã—Ö (fallback)

## üìñ –°—Å—ã–ª–∫–∏ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

- –û—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://core.telegram.org/bots/webapps
- –°–æ–±—ã—Ç–∏—è: https://core.telegram.org/bots/webapps#events-available-for-mini-apps
- –ü–æ–ª—è WebApp: https://core.telegram.org/bots/webapps#initializing-mini-apps
- Bot API 8.0 –∏–∑–º–µ–Ω–µ–Ω–∏—è: https://core.telegram.org/bots/api-changelog#november-17-2024

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–°–æ–±—ã—Ç–∏—è `activated` –∏ `deactivated` –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –≤ Bot API 8.0+**
   - –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –≤–µ—Ä—Å–∏—é –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏–π

2. **–ü–æ–ª–µ `isActive` –¥–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –≤ Bot API 8.0+**
   - –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –Ω–∞–ª–∏—á–∏–µ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º

3. **–°–æ–±—ã—Ç–∏–µ `viewportChanged` –¥–æ—Å—Ç—É–ø–Ω–æ –≤–æ –≤—Å–µ—Ö –≤–µ—Ä—Å–∏—è—Ö**
   - –ù–æ –ø–∞—Ä–∞–º–µ—Ç—Ä `isStateStable` –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –≤ —Ä–∞–∑–Ω—ã—Ö –≤–µ—Ä—Å–∏—è—Ö

4. **–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–æ–±—ã—Ç–∏—è**
   - `visibilityChanged` - –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
   - `close` - –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
   - –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –¥—Ä—É–≥–∏—Ö —Ñ–∞–π–ª–æ–≤

–ï—Å–ª–∏ –≤ –¥—Ä—É–≥–∏—Ö —Ñ–∞–π–ª–∞—Ö –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–æ—Ö–æ–∂–∏–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã, –∏—Ö –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ:

1. –ó–∞–º–µ–Ω–∏—Ç—å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å–æ–±—ã—Ç–∏—è –Ω–∞ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ
2. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤–µ—Ä—Å–∏–∏ API
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ–ª—è –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
4. –î–æ–±–∞–≤–∏—Ç—å fallback –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏–π
